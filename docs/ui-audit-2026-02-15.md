# Audit UI — 2026-02-15

## Objectif

Réaliser une passe de cohérence visuelle et ergonomique sur le frontend BikeVoyager
avec une trace vérifiable (changements + tests).

## Périmètre

- navigation shell (desktop/mobile)
- thème global (couleurs, typographie, tailles, radius)
- panneaux fonctionnels (navigation, POI, tournée)
- écran Aide (diagnostic cloud)

## Critères d’audit

- cohérence typographique: même échelle de tailles et interlignes
- cohérence des composants: mêmes radius/tailles par niveau d’importance
- lisibilité: contraste et hiérarchie claire des actions
- ergonomie mobile: pas de débordement horizontal, cibles lisibles
- lisibilité opérationnelle: informations utiles affichées sans bruit inutile

## Changements appliqués

### 1) Système visuel global

Fichier: `frontend/src/theme.ts`

- échelle typographique explicite (`fontSizes`, `lineHeights`, `headings.sizes`)
- defaults composants homogènes:
  - `Button`: `size=sm`, `radius=md`
  - `ActionIcon`: `radius=md`
  - `SegmentedControl`: `size=sm`, `radius=xl`
  - `TextInput`, `NumberInput`, `PasswordInput`, `Checkbox`, `Slider`: `size=sm`
  - `Paper`, `Badge`: radius harmonisés

### 2) Ergonomie mobile (menu bas)

Fichier: `frontend/src/App.tsx`

- menu mobile contraint en largeur sans débordement:
  - distribution égale des items (`flex: 1`, `minWidth: 0`)
  - `nowrap`, `gap=0`, texte sur 1 ligne
- état actif plus lisible (`fontWeight` renforcé)

### 3) Cohérence des panneaux

Fichiers:

- `frontend/src/features/app/components/MapCollapsibleSection.tsx`
- `frontend/src/features/app/components/NavigationOptionsPanel.tsx`
- `frontend/src/features/app/components/PoiPanel.tsx`
- `frontend/src/features/app/components/DeliveryPlannerPanel.tsx`

Actions:

- orientation des chevrons corrigée dans les sections repliables
- paddings adaptés compact/desktop pour homogénéité des densités
- radius harmonisés sur les cartes de liste
- espacement standardisé dans le panneau de tournée

### 4) Nettoyage du contenu Aide

Fichiers:

- `frontend/src/App.tsx`
- `frontend/src/i18n.ts`

Actions:

- suppression de l’affichage `Backend cache` et `Fallback`
- conservation de l’état de cache distribué + message de diagnostic + heure serveur
- suppression des clés i18n devenues inutilisées

### 5) Maintenabilité des chaînes techniques

Fichiers:

- `frontend/src/features/app/apiPaths.ts`
- `frontend/src/App.tsx`
- `frontend/src/features/app/cloudSync.ts`
- `frontend/src/components/PlaceSearchInput.tsx`
- `frontend/src/test/App.test.tsx`
- `frontend/e2e/app-shell.spec.ts`

Actions:

- centralisation des endpoints `/api/...` dans une constante unique `apiPaths`
- remplacement des chaînes hardcodées dans le code applicatif et les tests
- réduction du risque de divergence lors d’un renommage d’endpoint

## Couverture E2E ajoutée

### Outillage

- ajout de Playwright:
  - `frontend/playwright.config.ts`
  - scripts npm: `e2e`, `e2e:ui`
  - exclusion `e2e/**` côté Vitest (`frontend/vite.config.ts`)

### Scénarios

Fichier: `frontend/e2e/app-shell.spec.ts`

- `footer mobile sans debordement horizontal`
- `aide affiche le statut cloud utile sans backend/fallback`
- `parcours utilisateur complet planifier vers carte`

Les tests E2E mockent `/api/*` côté navigateur pour rester stables et rapides.

### CI

Fichier: `.github/workflows/ci.yml`

- installation Playwright Chromium (`npx playwright install --with-deps chromium`)
- exécution E2E (`npm run e2e`) dans le job frontend

## Validation exécutée

Commandes exécutées dans `frontend/`:

- `npm run lint` ✅
- `npm run test` ✅
- `npm run build` ✅
- `npm run e2e` ✅

Note: la suite Vitest affiche des warnings `act(...)` déjà présents avant cette passe.

## Risques résiduels

- pas de snapshot visuel cross-browser (Safari/Firefox) à ce stade
- pas de test E2E sur parcours complet API réelle (volontairement mocké ici)
